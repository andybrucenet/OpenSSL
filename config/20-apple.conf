my %targets = ();

## Define common configurations that can be reused across targets

%targets = (
    ## Common architecture settings
    "arch-arm64-common" => {
        template         => 1,
        cflags           => add("-arch arm64"),
        asm_arch         => 'aarch64',
        bn_ops           => "SIXTY_FOUR_BIT_LONG RC4_CHAR",
        lib_cppflags     => add("-DL_ENDIAN"),
    },
    
    "arch-arm64e-common" => {
        template         => 1,
        cflags           => add("-arch arm64e"),
        asm_arch         => 'aarch64',
        bn_ops           => "SIXTY_FOUR_BIT_LONG RC4_CHAR",
        lib_cppflags     => add("-DL_ENDIAN"),
    },
    
    "arch-x86_64-common" => {
        template         => 1,
        cflags           => add('-arch x86_64'),
        lib_cppflags     => add("-DL_ENDIAN"),
        bn_ops           => "SIXTY_FOUR_BIT_LONG",
    },
    
    "arch-i386-common" => {
        template         => 1,
        cflags           => add('-arch i386'),
        lib_cppflags     => add("-DL_ENDIAN"),
        bn_ops           => "BN_LLONG RC4_INT",
        asm_arch         => 'x86',
    },
    
    ## Common Apple OS settings
    "apple-common" => {
        template         => 1,
        disable          => [ "engine", "async" ],
##         enable           => [ "weak-ssl-ciphers" ]
    },
    
    "apple-common-simulator" => {
        template         => 1,
        inherit_from     => [ "apple-common" ],
    },
    
    ## Base settings for iOS
    "ios-cross-base" => {
        inherit_from     => [ "apple-common" ],
        template         => 1,
        cflags           => combine('-isysroot $(CROSS_TOP)/SDKs/$(CROSS_SDK) -fno-common', 
                              sub { defined($ENV{'IPHONEOS_DEPLOYMENT_VERSION'}) ? 
                                   '-mios-version-min=$(IPHONEOS_DEPLOYMENT_VERSION)' : 
                                   '-mios-version-min=12.0'; }),
    },

    ## Base settings for iOS Simulator
    "ios-sim-cross-base" => {
        inherit_from     => [ "ios-cross-base", "apple-common-simulator" ],
        template         => 1,
        cflags           => add( sub { defined($ENV{'IPHONEOS_DEPLOYMENT_VERSION'}) ? 
                                      '-mios-simulator-version-min=$(IPHONEOS_DEPLOYMENT_VERSION)' : 
                                      '-mios-simulator-version-min=12.0'; }),
    },

    ## Base settings for tvOS, watchOS, and XROS (all have similar patterns)
    "tvos-cross-base" => {
        inherit_from     => [ "apple-common" ],
        template         => 1,
        cflags           => combine('-isysroot $(CROSS_TOP)/SDKs/$(CROSS_SDK) -fno-common', 
                              sub { defined($ENV{'APPLETVOS_DEPLOYMENT_VERSION'}) ? 
                                   '-mtvos-version-min=$(APPLETVOS_DEPLOYMENT_VERSION)' : 
                                   '-mtvos-version-min=9.0'; }),
        defines          => [ "HAVE_FORK=0" ]
    },
    
    "watchos-cross-base" => {
        inherit_from     => [ "apple-common" ],
        template         => 1,
        cflags           => combine('-isysroot $(CROSS_TOP)/SDKs/$(CROSS_SDK) -fno-common', 
                              sub { defined($ENV{'WATCHOS_DEPLOYMENT_VERSION'}) ? 
                                   '-mwatchos-version-min=$(WATCHOS_DEPLOYMENT_VERSION)' : 
                                   '-mwatchos-version-min=2.0'; }),
        defines          => [ "HAVE_FORK=0" ]
    },
    
    "xros-cross-base" => {
        inherit_from     => [ "apple-common" ],
        template         => 1,
        cflags           => combine('-isysroot $(CROSS_TOP)/SDKs/$(CROSS_SDK) -fno-common', 
                              sub { defined($ENV{'XROS_DEPLOYMENT_VERSION'}) ? 
                                   '-mtargetos=xros$(XROS_DEPLOYMENT_VERSION)' : 
                                   '-mtargetos=xros1.0'; }),
    },
    
    ## Simulator base settings
    "tvos-sim-cross-base" => {
        inherit_from     => [ "tvos-cross-base", "apple-common-simulator" ],
        template         => 1,
        cflags           => add( sub { defined($ENV{'APPLETVOS_DEPLOYMENT_VERSION'}) ? 
                                      '-mtvos-simulator-version-min=$(APPLETVOS_DEPLOYMENT_VERSION)' : 
                                      '-mtvos-simulator-version-min=9.0'; }),
    },
    
    "watchos-sim-cross-base" => {
        inherit_from     => [ "watchos-cross-base", "apple-common-simulator" ],
        template         => 1,
        cflags           => add( sub { defined($ENV{'WATCHOS_DEPLOYMENT_VERSION'}) ? 
                                      '-mwatchos-simulator-version-min=$(WATCHOS_DEPLOYMENT_VERSION)' : 
                                      '-mwatchos-simulator-version-min=2.0'; }),
    },
    
    "xros-sim-cross-base" => {
        inherit_from     => [ "xros-cross-base", "apple-common-simulator" ],
        template         => 1,
        cflags           => add( sub { defined($ENV{'XROS_DEPLOYMENT_VERSION'}) ? 
                                      '-mtargetos=xros$(XROS_DEPLOYMENT_VERSION)-simulator' : 
                                      '-mtargetos=xros1.0-simulator'; }),
    },
    
    ## Catalyst
    "mac-catalyst-cross-base" => {
        inherit_from     => [ "apple-common" ],
        template         => 1,
        cflags           => combine('-isysroot $(CROSS_TOP)/SDKs/$(CROSS_SDK) -fno-common -mios-version-min=10.15'),
    },

    ## macOS
    "macos-base" => {
        inherit_from     => [ "apple-common" ],
        template         => 1,
        cflags           => add('-isysroot $(CROSS_TOP)/SDKs/$(CROSS_SDK)'),
        sys_id           => "MacOSX",
    },
    
    #-------------------------------------------------------------------------
    # Actual build targets follow, using the common definitions above
    #-------------------------------------------------------------------------
    
    ## macOS targets
    "macos-x86_64" => {
        inherit_from     => [ "macos-base", "arch-x86_64-common" ],
    },

    "macos-arm64" => {
        inherit_from     => [ "macos-base", "arch-arm64-common" ],
    },

    "macos-arm64e" => {
        inherit_from     => [ "macos-base", "arch-arm64e-common" ],
        CFLAGS           => add("-Wall"),
    },
    
    ## Mac Catalyst targets
    "mac-catalyst-x86_64" => {
        inherit_from     => [ "mac-catalyst-cross-base", "arch-x86_64-common" ],
        cflags           => add("-target x86_64-apple-ios14.0-macabi"),
        sys_id           => "MacOSX",
    },

    "mac-catalyst-arm64" => {
        inherit_from     => [ "mac-catalyst-cross-base", "arch-arm64-common" ],
        cflags           => add("-target arm64-apple-ios14.0-macabi"),
        sys_id           => "MacOSX",
    },
    
    ## Apple iOS simulator targets
    "ios-sim-cross-x86_64" => {
        inherit_from     => [ "ios-sim-cross-base", "arch-x86_64-common" ],
        CC               => "xcrun -sdk iphonesimulator cc",
        sys_id           => "iOS",
        perlasm_scheme   => "ios64",
    },

    "ios-sim-cross-i386" => {
        inherit_from     => [ "ios-sim-cross-base", "arch-i386-common" ],
        CC               => "xcrun -sdk iphonesimulator cc",
        sys_id           => "iOS",
    },

    "ios-sim-cross-arm64" => {
        inherit_from     => [ "ios-sim-cross-base", "arch-arm64-common" ],
        CC               => "xcrun -sdk iphonesimulator cc",
        perlasm_scheme   => "ios64",
        sys_id           => "iOS",
    },

    "ios-sim-cross-arm64e" => {
        inherit_from     => [ "ios-sim-cross-base", "arch-arm64e-common" ],
        CC               => "xcrun -sdk iphonesimulator cc",
        perlasm_scheme   => "ios64",
        sys_id           => "iOS",
    },

    ## Apple iOS targets
    "ios-cross-arm64" => {
        inherit_from     => [ "ios-cross-base", "arch-arm64-common" ],
        perlasm_scheme   => "ios64",
        sys_id           => "iOS",
    },

    "ios-cross-arm64e" => {
        inherit_from     => [ "ios-cross-base", "arch-arm64e-common" ],
        perlasm_scheme   => "ios64",
        sys_id           => "iOS",
    },

    "ios-cross-armv7s" => {
        inherit_from     => [ "darwin-common", "ios-cross-base" ],
        cflags           => add("-arch armv7s"),
        asm_arch         => 'armv4',
        perlasm_scheme   => "ios32",
        sys_id           => "iOS",
    },

    "ios-cross-armv7" => {
        inherit_from     => [ "darwin-common", "ios-cross-base" ],
        cflags           => add("-arch armv7"),
        asm_arch         => 'armv4',
        perlasm_scheme   => "ios32",
        sys_id           => "iOS",
    },
    
    ## Apple XROS simulator targets
    "xros-sim-cross-x86_64" => {
        inherit_from     => [ "xros-sim-cross-base", "arch-x86_64-common" ],
        CC               => "xcrun -sdk xrsimulator cc",
        sys_id           => "XROS",
        perlasm_scheme   => "xros64",
    },

    "xros-sim-cross-arm64" => {
        inherit_from     => [ "xros-sim-cross-base", "arch-arm64-common" ],
        CC               => "xcrun -sdk xrsimulator cc",
        perlasm_scheme   => "xros64",
        sys_id           => "XROS",
    },

    "xros-sim-cross-arm64e" => {
        inherit_from     => [ "xros-sim-cross-base", "arch-arm64e-common" ],
        CC               => "xcrun -sdk xrsimulator cc",
        perlasm_scheme   => "xros64",
        sys_id           => "XROS",
    },

    ## Apple XROS targets
    "xros-cross-arm64" => {
        inherit_from     => [ "xros-cross-base", "arch-arm64-common" ],
        perlasm_scheme   => "xros64",
        sys_id           => "XROS",
    },

    "xros-cross-arm64e" => {
        inherit_from     => [ "xros-cross-base", "arch-arm64e-common" ],
        perlasm_scheme   => "xros64",
        sys_id           => "XROS",
    },

    ## Apple tvOS simulator targets
    "tvos-sim-cross-x86_64" => {
        inherit_from     => [ "tvos-sim-cross-base", "arch-x86_64-common" ],
        CC               => "xcrun -sdk appletvsimulator cc",
        sys_id           => "tvOS",
        perlasm_scheme   => "tvos64",
    },

    "tvos-sim-cross-i386" => {
        inherit_from     => [ "tvos-sim-cross-base", "arch-i386-common" ],
        CC               => "xcrun -sdk appletvsimulator cc",
        sys_id           => "tvOS",
    },

    "tvos-sim-cross-arm64" => {
        inherit_from     => [ "tvos-sim-cross-base", "arch-arm64-common" ],
        CC               => "xcrun -sdk appletvsimulator cc",
        perlasm_scheme   => "tvos64",
        sys_id           => "tvOS",
    },

    "tvos-sim-cross-arm64e" => {
        inherit_from     => [ "tvos-sim-cross-base", "arch-arm64e-common" ],
        CC               => "xcrun -sdk appletvsimulator cc",
        perlasm_scheme   => "tvos64",
        sys_id           => "tvOS",
    },

    ## Apple tvOS targets
    "tvos-cross-arm64" => {
        inherit_from     => [ "tvos-cross-base", "arch-arm64-common" ],
        perlasm_scheme   => "tvos64",
        sys_id           => "tvOS",
    },

    "tvos-cross-arm64e" => {
        inherit_from     => [ "tvos-cross-base", "arch-arm64e-common" ],
        perlasm_scheme   => "tvos64",
        sys_id           => "tvOS",
    },

    ## Apple watchOS simulator targets
    "watchos-sim-cross-x86_64" => {
        inherit_from     => [ "watchos-sim-cross-base", "arch-x86_64-common" ],
        CC               => "xcrun -sdk watchsimulator cc",
        sys_id           => "watchOS",
        perlasm_scheme   => "watchos64",
    },

    "watchos-sim-cross-i386" => {
        inherit_from     => [ "watchos-sim-cross-base", "arch-i386-common" ],
        CC               => "xcrun -sdk watchsimulator cc",
        sys_id           => "watchos",
    },

    "watchos-sim-cross-arm64" => {
        inherit_from     => [ "watchos-sim-cross-base", "arch-arm64-common" ],
        CC               => "xcrun -sdk watchsimulator cc",
        perlasm_scheme   => "watchos64",
        sys_id           => "watchOS",
    },

    "watchos-sim-cross-arm64e" => {
        inherit_from     => [ "watchos-sim-cross-base", "arch-arm64e-common" ],
        CC               => "xcrun -sdk watchsimulator cc",
        perlasm_scheme   => "watchos64",
        sys_id           => "watchOS",
    },

    ## Apple watchOS targets
    "watchos-cross-arm64" => {
        inherit_from     => [ "watchos-cross-base", "arch-arm64-common" ],
        perlasm_scheme   => "watchos64",
        sys_id           => "watchOS",
    },

    "watchos-cross-arm64_32" => {
        inherit_from     => [ "darwin-common", "watchos-cross-base" ],
        cflags           => add("-arch arm64_32"),
        asm_arch         => 'aarch64',
        bn_ops           => "BN_LLONG RC4_INT",
        lib_cppflags     => add("-DL_ENDIAN"),
        perlasm_scheme   => "watchos64",
        sys_id           => "watchOS",
    },

    "watchos-cross-armv7k" => {
        inherit_from     => [ "darwin-common", "watchos-cross-base" ],
        cflags           => add("-arch armv7k"),
        asm_arch         => 'aarch32',
        bn_ops           => "BN_LLONG RC4_INT",
        sys_id           => "watchOS",
    },
);